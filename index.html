<script>
    // TVŮJ KONFIGURAČNÍ MODUL
    const API_KEY = "B11F82587E3FE85D24EC3AE5EDD62B68";
    const proxy = "https://api.allorigins.win/get?url=";

    // --- MODULE: ROUTING ---
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        document.getElementById('page-' + pageId).classList.remove('hidden');
    }

    // --- MODULE: AUTH & REAL LOADING ---
    async function handleLogin() {
        const steamId = document.getElementById('steam-id-input').value.trim();
        if (steamId.length < 15) return alert("Prosím zadej platné 17-místné SteamID64");

        const btn = document.getElementById('auth-btn');
        btn.innerText = "Skenuji Steam...";
        btn.disabled = true;

        // Volání reálných dat
        const games = await fetchSteamGames(steamId);

        if (games && games.length > 0) {
            document.getElementById('page-auth').classList.add('hidden');
            document.getElementById('nav-links').classList.remove('hidden');
            showPage('library');
            renderLibrary(games);
            initMarket(); // Načte ukázkový marketplace
        } else {
            alert("Nepodařilo se načíst hry. Zkontroluj, zda máš profil a detaily o hrách nastaveny jako VEŘEJNÉ (Public).");
            btn.innerText = "Zkusit znovu";
            btn.disabled = false;
        }
    }

    // --- MODULE: STEAM API FETCH ---
    async function fetchSteamGames(steamId) {
        const steamUrl = `https://api.steampowered.com/IPlayerService/GetOwnedGames/v1/?key=${API_KEY}&steamid=${steamId}&include_appinfo=1&format=json`;
        
        try {
            const response = await fetch(proxy + encodeURIComponent(steamUrl));
            const data = await response.json();
            const contents = JSON.parse(data.contents);

            if (contents.response && contents.response.games) {
                return contents.response.games; // Vrátí pole her
            }
            return [];
        } catch (e) {
            console.error("Chyba API:", e);
            return [];
        }
    }

    // --- MODULE: RENDER ---
    function renderLibrary(games) {
        const grid = document.getElementById('library-grid');
        document.getElementById('lib-count').innerText = `${games.length} HER NALEZENO`;
        
        grid.innerHTML = games.map(g => `
            <div class="game-card">
                <img class="game-img" src="https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/${g.appid}/header.jpg" 
                     onerror="this.src='https://via.placeholder.com/460x215?text=${g.name}'">
                <p class="text-[10px] font-bold truncate text-white uppercase tracking-tighter">${g.name}</p>
            </div>
        `).join('');
    }

    // --- MODULE: MARKETPLACE (UKÁZKA) ---
    function initMarket() {
        const list = document.getElementById('market-list');
        const data = [
            { u: "Uživatel_88", has: "Black Myth: Wukong", wants: "Cyberpunk" },
            { u: "Gamer_X", has: "Rust", wants: "DayZ" }
        ];

        list.innerHTML = data.map(item => `
            <div class="market-item p-5 flex justify-between items-center rounded border border-white/5 mb-2">
                <div>
                    <p class="text-[9px] text-sky-500 font-black uppercase">${item.u}</p>
                    <p class="text-sm font-bold text-white">Má: ${item.has}</p>
                    <p class="text-xs text-gray-400">Chce: ${item.wants}</p>
                </div>
                <button class="bg-white/5 text-[10px] px-4 py-2 rounded uppercase font-bold">Domluvit</button>
            </div>
        `).join('');
    }
</script>
